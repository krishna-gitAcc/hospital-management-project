# ===============================
# Server Configuration
# ===============================
server.port=8080

# ===============================
# Spring Application
# ===============================
spring.application.name=gateway-service

# ===============================
# Spring Cloud Gateway Routes
# ===============================

# --- Route 0: auth-service ---
spring.cloud.gateway.routes[0].id=auth-service
spring.cloud.gateway.routes[0].uri=lb://auth-service
spring.cloud.gateway.routes[0].predicates[0]=Path=/api/auth/**
spring.cloud.gateway.routes[0].filters[0]=AddRequestHeader=X-Gateway-Secret, hospital-secret-key

# --- Route 1: patient-service ---
spring.cloud.gateway.routes[1].id=patient-service
spring.cloud.gateway.routes[1].uri=lb://patient-service
spring.cloud.gateway.routes[1].predicates[0]=Path=/api/patients/**
spring.cloud.gateway.routes[1].filters[0]=StripPrefix=2

# --- Route 2: doctor-service ---
spring.cloud.gateway.routes[2].id=doctor-service
spring.cloud.gateway.routes[2].uri=lb://doctor-service
spring.cloud.gateway.routes[2].predicates[0]=Path=/api/doctors/**
spring.cloud.gateway.routes[2].filters[0]=StripPrefix=2

# --- Route 3: appointment-service ---
spring.cloud.gateway.routes[3].id=appointment-service
spring.cloud.gateway.routes[3].uri=lb://appointment-service
spring.cloud.gateway.routes[3].predicates[0]=Path=/api/appointments/**
spring.cloud.gateway.routes[3].filters[0]=StripPrefix=2

# --- Route 4: billing-service ---
spring.cloud.gateway.routes[4].id=billing-service
spring.cloud.gateway.routes[4].uri=lb://billing-service
spring.cloud.gateway.routes[4].predicates[0]=Path=/api/billing/**
spring.cloud.gateway.routes[4].filters[0]=StripPrefix=2

# --- Route 5: graphql-gateway ---
spring.cloud.gateway.routes[5].id=graphql-gateway
spring.cloud.gateway.routes[5].uri=lb://graphql-api-gateway
spring.cloud.gateway.routes[5].predicates[0]=Path=/graphql/**
spring.cloud.gateway.routes[5].filters[0]=StripPrefix=1

# ===============================
# Eureka Client Configuration
# ===============================
eureka.client.service-url.defaultZone=http://admin:admin123@localhost:8761/eureka/
eureka.client.fetch-registry=true
eureka.client.register-with-eureka=true

# ===============================
# Management Endpoints (FIXED)
# ===============================
# 1. Expose all endpoints (including gateway)
management.endpoints.web.exposure.include=*
management.endpoints.web.base-path=/actuator

# 2. CRITICAL FIX: Set Access Level
# In Spring Cloud Gateway 4.x, use access=UNRESTRICTED.
management.endpoint.gateway.access=UNRESTRICTED
management.endpoint.health.show-details=always